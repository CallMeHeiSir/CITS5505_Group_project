<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Settings - Fitness Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/settingsStyle.css') }}"/>
</head>
<body>
  <div class="app-container">
    <div class="content">
      <!-- Sidebar -->
      <nav class="side-nav">
        <div class="logo">Fitness Dashboard</div>
        <a href="{{ url_for('index') }}" class="side-item {% if request.endpoint == 'index' %}active{% endif %}"><span>Home</span></a>
        <a href="{{ url_for('upload') }}" class="side-item {% if request.endpoint == 'upload' %}active{% endif %}"><span>Upload</span></a>
        <a href="{{ url_for('visualize') }}" class="side-item {% if request.endpoint == 'visualize' %}active{% endif %}"><span>Visualize</span></a>
        <a href="{{ url_for('forum') }}" class="side-item {% if request.endpoint == 'forum' %}active{% endif %}"><span>Forum</span></a>
        <a href="{{ url_for('settings') }}" class="side-item {% if request.endpoint == 'settings' %}active{% endif %}"><span>Settings</span></a>
        <div class="user-profile">
          {% if current_user.avatar %}
            <img src="{{ url_for('static', filename='avatars/' + current_user.avatar) }}" alt="User Avatar" class="user-avatar"/>
          {% else %}
            <img src="{{ url_for('static', filename='avatars/default.png') }}" alt="Default Avatar" class="user-avatar"/>
          {% endif %}
          <span class="username">{{ current_user.username }}</span>
        </div>
        <div class="top-logout">
          <a href="{{ url_for('auth.logout') }}" class="tab-btn active">Logout</a>
        </div>
      </nav>

      <!-- Main Content -->
      <main class="main-content">
        <div class="card" style="padding: 24px;">
          <!-- Flash Messages -->
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              <div class="flash-messages">
                {% for category, message in messages %}
                  <div class="flash-message flash-{{ category }}">
                    {{ message }}
                    <button type="button" class="flash-close">√ó</button>
                  </div>
                {% endfor %}
              </div>
            {% endif %}
          {% endwith %}

          <!-- ‰∏™‰∫∫‰ø°ÊÅØ -->
          <section style="text-align: center; margin-bottom: 24px;">
            {% if current_user.avatar %}
              <img src="{{ url_for('static', filename='avatars/' + current_user.avatar) }}" alt="Profile Picture" class="profile-img" style="margin-bottom: 12px;">
            {% else %}
              <img src="{{ url_for('static', filename='avatars/default.png') }}" alt="Profile Picture" class="profile-img" style="margin-bottom: 12px;">
            {% endif %}
            <h2>{{ current_user.username }}</h2>
            <p class="text-muted">{{ current_user.email }}</p>
            <p id="bioText" style="margin-top: 10px;">"No pain, no gain!"</p>
            <button class="btn-gradient" id="editBioBtn" style="margin-top: 8px; font-size: 0.8rem;">‚úèÔ∏è Edit Bio</button>
          </section>

          <!-- ‰øÆÊîπ‰∏™‰∫∫‰ø°ÊÅØË°®Âçï -->
          <section style="margin-bottom: 24px;">
            <h3>Edit Personal Information</h3>
            <form id="user-info-form" method="post" action="{{ url_for('auth.change_personal_information') }}" enctype="multipart/form-data" class="settings-form">
              <div class="form-group">
                <label for="username" class="form-label">Username:</label>
                <input type="text" id="username" name="username" class="form-input" placeholder="Enter your username" value="{{ current_user.username }}" required>
              </div>
              <div class="form-group">
                <label for="email" class="form-label">Email:</label>
                <input type="email" id="email" name="email" class="form-input" placeholder="Enter your email" value="{{ current_user.email }}" required>
              </div>
              <div class="form-group">
                <label for="phone" class="form-label">Phone Number:</label>
                <input type="tel" id="phone" name="phone" class="form-input" placeholder="Enter your phone number" value="{{ current_user.phone or '' }}">
              </div>
              <div class="form-group">
                <label for="gender" class="form-label">Gender:</label>
                <select id="gender" name="gender" class="form-input">
                  <option value="male" {% if current_user.gender == 'male' %}selected{% endif %}>Male</option>
                  <option value="female" {% if current_user.gender == 'female' %}selected{% endif %}>Female</option>
                  <option value="other" {% if current_user.gender == 'other' %}selected{% endif %}>Other</option>
                </select>
              </div>
              <div class="form-group">
                <label for="birthdate" class="form-label">Birthdate:</label>
                <input type="date" id="birthdate" name="birthdate" class="form-input" value="{{ current_user.birthdate | default('', true) }}">
              </div>
              <div class="form-group">
                <label for="address" class="form-label">Address:</label>
                <input type="text" id="address" name="address" class="form-input" placeholder="Enter your address" value="{{ current_user.address or '' }}">
              </div>
              <div class="form-group">
                <label for="avatar" class="form-label">Avatar:</label>
                <input type="file" id="avatar" name="avatar" class="form-input" accept="image/*">
              </div>
              <div class="form-group">
                <button type="submit" class="btn-gradient">Save Changes</button>
                <a href="{{ url_for('auth.retrieve_password') }}" class="btn-gradient" style="margin-left: 10px;">Change Password</a>
              </div>
            </form>
          </section>

          <!-- ÈÇÄËØ∑Â•ΩÂèã -->
          <section style="text-align: center; margin-top: 32px;">
            <a href="{{ url_for('friends') }}" class="btn-gradient" style="padding: 12px 24px;">üë• Invite Friends to Join Challenges</a>
          </section>
        </div>
      </main>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
</body>
</html>